# yaml-language-server: $schema=https://taskfile.dev/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj
version: '3'

tasks:
  prepare-server-base:
    internal: true
    cmds:
      - powershell New-Item -Path "build/server/resources" -ItemType Directory -ErrorAction Ignore -Force
      - powershell Copy-Item -Path "server/resources/*" -Destination "build/server/resources" -Recurse -ErrorAction Ignore -Force
      - go build -o build/server/bin/genCert.exe ./server-genCert
  prepare-launcher:
    deps:
      - prepare-server-base
      - :build-config-all
      - prepare-battle-server-manager-base
    cmds:
      - go build -o build/server ./server
      - powershell New-Item -ItemType Directory -Force -Path build/launcher/resources -ErrorAction Ignore
      - powershell Copy-Item -Path launcher/resources/config.game.toml -Destination build/launcher/resources/config.age1.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path launcher/resources/config.game.toml -Destination build/launcher/resources/config.age2.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path launcher/resources/config.game.toml -Destination build/launcher/resources/config.age3.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path launcher/resources/config.game.toml -Destination build/launcher/resources/config.athens.toml -ErrorAction Ignore -Force
      - go build -o build/launcher/bin/agent.exe ./launcher-agent
  prepare-server-genCert:
    cmds:
      - powershell New-Item -ItemType Directory -ErrorAction Ignore -Force -Path build/server/resources
  prepare-battle-server-manager-base:
    deps:
      - :build-battle-server-manager
    cmds:
      - powershell New-Item -ItemType Directory -Force -Path build/battle-server-manager/resources -ErrorAction Ignore
      - powershell Copy-Item -Path battle-server-manager/resources/config.game.toml -Destination build/battle-server-manager/resources/config.age1.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path battle-server-manager/resources/config.game.toml -Destination build/battle-server-manager/resources/config.age2.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path battle-server-manager/resources/config.game.toml -Destination build/battle-server-manager/resources/config.age3.toml -ErrorAction Ignore -Force
      - powershell Copy-Item -Path battle-server-manager/resources/config.game.toml -Destination build/battle-server-manager/resources/config.athens.toml -ErrorAction Ignore -Force